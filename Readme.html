<h1>Kingdom Assignment</h1>

<p>Description goes here.</p>

<h2>Prerequisites</h2>

<p>In order to install this gem you need to have several programs
installed:</p>

<ul>
<li>Ruby either in version 1.8.7 or 1.9.2. The use of JRuby (a Java implementation of Ruby) is recommended.</li>
</ul>

<h3>Installing Git</h3>

<p>An installer for Mac OS X can be obtained from the <a href="http://git-scm.com/">official website</a>. For any Linux distribution it is recommended that you use your system's package manager to install Git. Look for a package called git or git-core. For Ubuntu 10.10 the command is:</p>

<pre><code>sudo apt-get install git
</code></pre>

<h3>Installing cURL</h3>

<p>Mac OS X comes with curl by default, on a Linux distribution, curl can be obtained via the system's package manager. For Ubuntu 10.10 the command is:</p>

<pre><code>sudo apt-get install curl
</code></pre>

<h3>Installing JRuby</h3>

<p>Very few distributions offer packages for the most recent version of JRuby.
The easiest way to install the most recent version of JRuby is via the <a href="http://rvm.beginrescueend.com/">Ruby Version Manager</a> by Wayne E. Seguin.</p>

<p>Before you install RVM, make sure you have git and curl installed on your system.</p>

<p>RVM can be installed by calling:</p>

<pre><code>bash &lt; &lt;( curl http://rvm.beginrescueend.com/releases/rvm-install-head )
</code></pre>

<p>This will install RVM to .rvm in your home folder and print several instructions specific to your platform on how to finish the installation. Please pay close attention to the "dependencies" section and look for the part where it says something like this:</p>

<pre><code># For Ruby (MRI &amp; ree)  you should install the following OS dependencies:
ruby: /usr/bin/apt-get install build-essential bison openssl libreadline6 libreadline6-dev curl git-core zlib1g zlib1g-dev libssl-dev libyaml-dev libsqlite3-0 libsqlite3-dev sqlite3 libxml2-dev libxslt-dev autoconf libc6-dev ncurses-dev
</code></pre>

<p>These are the requirements for building the normal C version of Ruby. However, many of those tools are also required for building the Java version of Ruby so it is advisable that you install all of these prerequisites. Please do not copy the commands from this file, look at the output of the RVM installer.</p>

<pre><code>sudo apt-get install build-essential bison openssl libreadline6 libreadline6-dev curl git-core zlib1g zlib1g-dev libssl-dev libyaml-dev libsqlite3-0 libsqlite3-dev sqlite3 libxml2-dev libxslt-dev autoconf libc6-dev ncurses-dev
</code></pre>

<p>If installing any of these packages gives you an error, consider updating your packages by using your system's update manager.</p>

<p>Next you need to install the tools that are specifically required for installing JRuby. The output of RVM might look like this:</p>

<pre><code># For JRuby (if you wish to use it) you will need:
  jruby: /usr/bin/apt-get install curl g++ openjdk-6-jre-headless
  jruby-head: /usr/bin/apt-get install ant openjdk-6-jdk
</code></pre>

<p>It is recommended that you use the latest stable version of JRuby, not jruby-head. Accordingly, on Ubuntu 10.10 you have to install the following packages in order to use JRuby with RVM:</p>

<pre><code>apt-get install curl g++ openjdk-6-jre-headless
</code></pre>

<p>Next, you have to make sure that RVM is loaded when you start a new shell. Look for the part where it says: "You must now complete the install by loading RVM in new shells."</p>

<p>On Ubuntu 10.10 you can edit your .bashrc by calling:</p>

<pre><code>gedit .bashrc
</code></pre>

<p>On Mac OS X, you can type:</p>

<pre><code>open -a TextEdit .bash_profile
</code></pre>

<p>At the very end of this file add the following line:</p>

<pre><code>[[ -s "$HOME/.rvm/scripts/rvm" ]] &amp;&amp; source "$HOME/.rvm/scripts/rvm"  # This loads RVM into a shell session.
</code></pre>

<p>Now save the file, close your editor and close your shell. Start a new shell and type:</p>

<pre><code>type rvm | head -1
</code></pre>

<p>If you see something like "rvm is a function" the installation was successful. If you run into problems, read the <a href="http://rvm.beginrescueend.com/rvm/install/">documentation</a>. You can always delete RVM and start from scratch by typing:</p>

<pre><code>rvm implode
</code></pre>

<p>Please note that this will delete all versions of Ruby you installed with RVM as well as all of the gems you installed. It will not reverse the changes you made to your shell's load configuration.</p>

<p>Now you can install JRuby by calling:</p>

<pre><code>rvm install jruby
</code></pre>

<p>Please note that everything RVM installs is placed in the folder .rvm in your home directory. Therefore, it is not necessary to use sudo when calling rvm.</p>

<p>In order to use JRuby instead of your system's Ruby version you must type</p>

<pre><code>rvm use jruby
</code></pre>

<p>every time you open a new shell. You can check which version you are currently using with:</p>

<pre><code>ruby -v
</code></pre>

<p>If you want to switch back to the version of Ruby that came with your system, type:</p>

<pre><code>rvm use system
</code></pre>

<p>In order to use JRuby as the default Ruby implementation on your system you can type:</p>

<pre><code>rvm --default use jruby
</code></pre>

<p>Now JRuby will be called when you type ruby in a new shell.</p>

<h3>Installing MySQL</h3>

<p>Kingdom Assignment uses a MySQL database in order to store information from the <a href="ftp://ftp.ncbi.nih.gov/pub/taxonomy/">NCBI taxonomy database</a> efficiently.</p>

<p>The database does not have to be hosted on the system that is running Kingdom Assignment, but it is advantageous for performance reasons.</p>

<p>The correct installation procedure for MySQL varies widely among different platforms. For many systems (like Mac OS X) binaries can be obtained from the <a href="http://www.mysql.com/downloads/mysql/">official website</a>. In the following, the setup under Ubuntu 10.10 is explained.</p>

<pre><code>sudo apt-get install mysql-server
</code></pre>

<p>On Mac OS X, you can install the MySQL preference pane and start the server from there. The MySQL binaries are at /usr/local/mysql/bin/. In order to be able to execute the following examples without having to prefix this path every time, you can add aliases to your bash configuration:</p>

<pre><code>open -a TextEdit .bash_profile
</code></pre>

<p>Now add the following lines at the end:</p>

<pre><code>alias mysql=/usr/local/mysql/bin/mysql
alias mysqladmin=/usr/local/mysql/bin/mysqladmin
</code></pre>

<p>Refer to the ReadMe file that comes with the MySQL installer if you are using tclsh instead of bash.</p>

<h3>Starting the database</h3>

<p>Usually the MySQL setup creates an administrator account named "root" with
an empty password. If your administrator name is different or you have
set a password, you must adjust the commands in the next section accordingly.
You can now start MySQL by typing</p>

<pre><code>sudo service mysql start
</code></pre>

<h2>NCBI taxonomy database</h2>

<p>In this step you will download the latetst taxonomy database and transfer it to the MySQL database.</p>

<h3>Setting up the taxonomy database</h3>

<p>Now set up the database for the NCBI taxonomy:</p>

<pre><code>curl http://biosql.org/DIST/biosql-1.0.1.tar.gz -o biosql-1.0.1.tar.gz
tar -xzvf biosql-1.0.1.tar.gz
mysql -u root -e "CREATE DATABASE ncbi_taxonomy"
</code></pre>

<p>Next, you need to set up the Bio-SQL schema. Unfortunately, BioSQL 1.0.1 is only compatible with MySQL &lt;= 5.1 because it still uses TYPE=INNODB when creating tables. You can check if an <a href="http://www.biosql.org/">updated version is available</a> or use the following command to fix the issue:</p>

<pre><code>sed 's/TYPE=INNODB/ENGINE=INNODB/g' biosql-1.0.1/sql/biosqldb-mysql.sql &gt; biosql-1.0.1/sql/biosqldb-mysql5-5.sql
</code></pre>

<p>You can apply the schema with:</p>

<pre><code>mysql -u root ncbi_taxonomy -p &lt; biosql-1.0.1/sql/biosqldb-mysql5-5.sql
</code></pre>

<p>Now you need to download the latest taxonomy dump from NCBI an use a schript provided by BioSQL to load it into the database:</p>

<pre><code>curl ftp://ftp.ncbi.nlm.nih.gov/pub/taxonomy/taxdump.tar.gz -o taxdump.tar.gz
mkdir taxdata
tar -xzvf taxdump.tar.gz -C taxdata
perl biosql-1.0.1/scripts/load_ncbi_taxonomy.pl --dbname ncbi_taxonomy --dbuser root --directory taxdata
</code></pre>

<p>Loading all the taxonomy data into the database will take up to an hour.
If the last command gives you an error like:</p>

<pre><code>install_driver(mysql) failed: Can't locate DBD/mysql.pm
</code></pre>

<p>You need to install the MySQL database driver for Perl first.
On Mac OS X, use the following commands:</p>

<pre><code>export DYLD_LIBRARY_PATH=/usr/local/mysql/lib/
sudo perl -MCPAN -e 'install DBI'
sudo perl -MCPAN -e 'force ("install","DBD::mysql")'
</code></pre>

<p>On Ubuntu 10.10, you can install the corresponding package:</p>

<pre><code>sudo apt-get install libdbd-mysql-perl
</code></pre>

<p>Now, you can try executing a query to make sure everything worked as intendend:</p>

<pre><code>mysql -u root -D ncbi_taxonomy -e "SELECT taxon_id FROM taxon_name WHERE name='Homo sapiens';"
</code></pre>

<p>This should result in an output like this, giving you the NCBI taxonomy id of <em>Homo sapiens</em>. Please note that this id varies between different versions of the taxaonomy database:</p>

<pre><code>+---------------+
| ncbi_taxon_id |
+---------------+
|          7869 |
+---------------+
</code></pre>

<p>There are additional parameters to this script you can use if needed
 (taken from load_ncbi_taxonomy.pl):</p>

<pre><code>--dbname     # name of database to use
--dsn        # the DSN of the database to connect to
--driver     # "mysql", "Pg", "Oracle" (default "mysql")
--host       # optional: host to connect with
--port       # optional: port to connect with
--dbuser     # optional: user name to connect with
--dbpass     # optional: password to connect with
--download   # optional: whether to download new NCBI taxonomy data
--directory  # optional: where to store/look for the data
--schema     # optional: Pg only, load using given schema
</code></pre>

<h2>Installing Kingdom Assignment</h2>

<p>Kingdom assignment is delivered as a Ruby gem. In order to build and install it, you first have to install another gem called bundler. Type:</p>

<pre><code>rvm jruby gem install bundler
</code></pre>

<p>In order to install the other gems Kingdom Assignment depends on, first switch to JRuby:</p>

<pre><code>rvm use jruby
</code></pre>

<p>Now go to the folder called kingdom-assignment and type:</p>

<pre><code>bundle install
</code></pre>

<p>After that, create a Ruby gem by typing:</p>

<pre><code>rake install
</code></pre>

<p>Finally you can install the gem by typing:</p>

<pre><code>rvm jruby gem install pkg/kingdom-assignment-*.gem
</code></pre>

<p>Kingdom Assignment is now in your global path, meaning that from any point in the system you call use it by typing</p>

<pre><code>kingdom-assignment
</code></pre>

<p>on the command line. Please note that in order to do that you have to switch to JRuby as mentioned before.</p>

<h2>Using Kingdom Assignment</h2>

<h1>Copyright</h1>
